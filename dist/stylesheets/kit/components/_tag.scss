/**
 * Component Tag.
 *
 * @requires {function}    px-to-rem
 * @requires {mixin}       round
 * @requires {mixin}       text-truncate
 * @requires {placeholder} %ico
 * @requires {placeholder} %ico--close-circled
 * @requires {placeholder} %ico--editor-pencil-2
 * @requires ico
 */

// =============================================================================
// Tag
// =============================================================================

/**
 * 1. We need to increase specifity.
 */

.tag {
    @extend .tag.\--neutral;
    @extend .tag.\--medium;

    align-items: center;
    border: {
        radius: $tag-border-radius;
    }
    box-shadow: $tag-box-shadow;
    cursor: default;
    display: inline-flex;
    max-width: $tag-length;
    padding: {
        left: $tag-indent;
        right: $tag-indent;
    }
    position: relative;
    text: {
        decoration: none;
        shadow: $tag-text-shadow;
    }

    &[class] {          /* 1 */
        color: $tag-color;
    }
}

/**
 * Modifiers.
 */

/**
 * Tag, gutter.
 */

.tag {
    &.\--gutter {
        margin: {
            right: $tag-gutter;
            top: $tag-gutter;
        }
        max-width: 100%;
    }
}

/**
 * Tag, primary.
 */

.tag {
    &.\--primary {
        @include round($tag--primary-border-radius);

        cursor: pointer;
        transition:
            background-color 0.2s,
            border-color 0.2s,
            color 0.2s;
    }
}

/**
 * Tag, size.
 * 1. Negative margin workaround to prevent vertical crop of the tag content
 *  and enable text truncate at the same time.
 */

.tag {
    @each $modifier in map-keys($tag-size) {
        &.\--#{$modifier} {
            $size: px-to-em(
                map-get($tag-size, $modifier),
                map-get($tag-font-size, $modifier)
            );

            font-size: px-to-rem(
                map-get($tag-font-size, $modifier)
            );
            height: $size;
            line-height: $size;
        }
    }
}

/**
 * Tag, color themes.
 */

.tag {
    @each $modifier, $theme in $tag-theme {
        &.\--#{$modifier} {
            background: {
                color: map-get($theme, 50);
                image: linear-gradient(
                    120deg,
                    rgba(map-get($theme, 80), 0.25) 0%,
                    rgba(map-get($theme, 50), 0.00) 25%,
                    rgba(map-get($theme, 20), 0.25) 75%
                );
            }
        }
    }
}

/**
 * States.
 */

/**
 * Tag, active (aka pressed).
 */

.tag {
    &:active,
    &.is-active {
        &.\--primary {
            @each $modifier, $theme in $tag-theme {
                &.\--#{$modifier} {
                    background: {
                        color: darken(map-get($theme, 50), 15%);
                        image: none;
                    }
                }
            }
        }
    }
}

/**
 * Tag, disabled.
 * 1. We need to increase specifity.
 */

.tag[class][class] { /* 1 */
    &:disabled,
    &.is-disabled {
        box-shadow: none;
        opacity: 0.35;

        &,
        .tag__control {
            cursor: not-allowed;
        }
    }
}

/**
 * Tag, focused.
 */

.tag {
    &:focus:not(:disabled):not(.is-disabled),
    &.is-focused:not(:disabled):not(.is-disabled) {
        &.\--primary {
            @each $modifier, $theme in $tag-theme {
                &.\--#{$modifier} {
                    background-color: lighten(map-get($theme, 50), 15%);
                }
            }
        }

        .tag__control {
            opacity: 0.5;
        }
    }
}

/**
 * Tag, hovered.
 */

.tag {
    &:hover,
    &.is-hovered {
        @extend .tag:focus;
    }
}

/**
 * Context.
 */

// .has-component

// =============================================================================
// Subcomponents
// =============================================================================

// Tag control
// =============================================================================

/**
 * 1. Negative margin workaround to prevent vertical crop of the tag content
 *  and enable text truncate at the same time.
 */

.tag__content {
    @include text-truncate;

    margin: (-1) * $tag-indent 0; /* 1 */
    padding: $tag-indent 0;       /* 1 */
}

// Tag control
// =============================================================================

/**
 * 1. We need to increase specifity.
 */

.tag__control {
    align-items: center;
    cursor: pointer;
    display: inline-flex;
    justify-content: center;
    text-decoration: none;
    transition: opacity 0.2s;

    &::before {
        @extend %ico !optional;
    }

    &[class] {          /* 1 */
        color: inherit;
    }

    & + & {
        margin-left: 2px;
    }

    &:first-of-type {
        margin-left: (0.5) * $tag-indent;
    }
    &:last-child {
        margin-right: (-0.5) * $tag-indent;
    }
}

/**
 * Modifiers.
 */

/**
 * Tag control, edit.
 */

.tag__control {
    &.\--edit {
        &::before {
            @extend %ico--editor-pencil-2 !optional;
        }
    }
}

/**
 * Tag control, delete.
 */

.tag__control {
    &.\--delete {
        &::before {
            @extend %ico--close-circled !optional;
        }
    }
}

/**
 * States.
 */

/**
 * Tag control, hovered.
 * 1. We need to increase specifity.
 */

.tag__control[class][class][class] { /* 1 */
    &:hover {
        opacity: 1;
    }
}
